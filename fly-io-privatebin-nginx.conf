
daemon               off;
pid                  /run/nginx.pid;
worker_processes     auto;
worker_rlimit_nofile 13768;

# Load modules
include              /etc/nginx/modules-enabled/*.conf;

events {
    multi_accept       on;
    worker_connections 10000;
}

http {

    charset                utf-8;
    sendfile               on;
    tcp_nopush             on;
    tcp_nodelay            on;
    server_tokens          off;
    #log_not_found          off;
    #types_hash_max_size    2048;
    #types_hash_bucket_size 64;
    client_max_body_size   16M;
    keepalive_timeout      20s;

    charset_types text/css text/plain text/vnd.wap.wml application/javascript application/json application/rss+xml application/xml;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';


    # MIME
    include                mime.types;
    default_type           application/octet-stream;

    # Logging
    access_log             /dev/stdout;
    error_log              /dev/stderr warn;

    # Load configs
    include                /etc/nginx/conf.d/*.conf;

    # example.com
    server {
        listen                             8080 default_server;
        listen                             [::]:8080 default_server;
        #server_name                        example.com;
        set                                $base /srv/pb;
        root                               $base;

        # index.php
        index index.php;

        # index.php fallback
        location / {
        # no-transform tells Cloudflare and others to not change the content of
        # the file and thus breaking SRI.
        # https://developers.cloudflare.com/cache/about/cache-control#other
        add_header Cache-Control "public, max-age=3600, must-revalidate, no-transform";
        add_header Cross-Origin-Embedder-Policy require-corp;
        add_header Cross-Origin-Opener-Policy same-origin;
        add_header Cross-Origin-Resource-Policy same-origin;
        # opt-out of Google FloC
        # https://developer.chrome.com/blog/floc/#how-can-websites-opt-out-of-the-floc-computation
        add_header Permissions-Policy interest-cohort=();
        add_header Referrer-Policy no-referrer;
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options deny;
        add_header X-XSS-Protection "1; mode=block";

        include /etc/nginx/location.d/*.conf;
        try_files $uri $uri/ /index.php$is_args$args;
    }

        #Gzip
        gzip on;

        #Gzip settings
        gzip_comp_level    5;
        gzip_min_length    256;
        gzip_proxied       any;
        gzip_vary          on;

        gzip_types
          application/atom+xml
          application/javascript
          application/json
          application/ld+json
          application/manifest+json
          application/rss+xml
          application/vnd.geo+json
          application/vnd.ms-fontobject
          application/x-font-ttf
          application/x-web-app-manifest+json
          application/xhtml+xml
          application/xml
          font/opentype
          image/bmp
          image/svg+xml
          image/x-icon
          text/cache-manifest
          text/css
          text/plain
          text/vcard
          text/vnd.rim.location.xloc
          text/vtt
          text/x-component
          text/x-cross-domain-policy;

          #cache-file-descriptors
          open_file_cache          max=1000 inactive=20s;
          open_file_cache_valid    30s;
          open_file_cache_min_uses 2;
          open_file_cache_errors   on;

        # handle .php
        location ~ \.php$ {
            fastcgi_pass                  127.0.0.1:9000;

            # default fastcgi_params
            include                       fastcgi_params;

            # fastcgi settings
            fastcgi_index                 index.php;

            # fastcgi params
            fastcgi_param SERVER_SOFTWARE "";
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }
    }
}